<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <record id="action_report_bank_reconciliation" model="ir.actions.report">
        <field name="name">Bank Reconciliation Statement</field>
        <field name="model">bank.reconciliation.console</field>
        <field name="report_type">qweb-pdf</field>
        <field name="report_name">focus_bank_reconciliation.report_bank_reconciliation_doc</field>
        <field name="report_file">focus_bank_reconciliation.report_bank_reconciliation_doc</field>
        <field name="binding_model_id" ref="model_bank_reconciliation_console"/>
        <field name="binding_type">report</field>
    </record>

    <template id="report_bank_reconciliation_doc">
        <t t-call="web.html_container">
            <t t-foreach="docs" t-as="o">
                <t t-call="web.external_layout">
                    <div class="page">
                        <div class="text-center" style="border-bottom: 2px solid black; margin-bottom: 20px;">
                            <h2>Bank Reconciliation Statement</h2>
                            <p>
                                <strong>Bank:</strong>
                                <span t-field="o.bank_journal_id.name"/>
                                <br/>
                                <strong>Period Ending:</strong>
                                <span t-field="o.date_to"/>
                            </p>
                        </div>

                        <div class="row">
                            <div class="col-8">
                                <strong>Balance as per Book (Ledger)</strong>
                            </div>
                            <div class="col-4 text-right">
                                <span t-field="o.book_balance"
                                      t-options='{"widget": "monetary", "display_currency": o.currency_id}'/>
                            </div>
                        </div>

                        <t t-set="r_data" t-value="report_data[o.id]"/>

                        <div class="mt-3">
                            <strong>ADD: Checks Issued but not Presented</strong>
                            <table class="table table-sm table-borderless" style="font-size: 0.9em; margin-left: 20px;">
                                <tr t-foreach="r_data['unpresented_checks']" t-as="line">
                                    <td>
                                        <span t-field="line.date"/>
                                    </td>
                                    <td>
                                        <span t-field="line.ref"/>
                                    </td>
                                    <td>
                                        <span t-field="line.partner_id.name"/>
                                    </td>
                                    <td class="text-right">
                                        <span t-field="line.credit"
                                              t-options='{"widget": "monetary", "display_currency": o.currency_id}'/>
                                    </td>
                                </tr>
                                <tr style="border-top: 1px solid #ccc;">
                                    <td colspan="3" class="text-right">
                                        <strong>Total Unpresented:</strong>
                                    </td>
                                    <td class="text-right">
                                        <span t-esc="r_data['total_unpresented']"
                                              t-options='{"widget": "monetary", "display_currency": o.currency_id}'/>
                                    </td>
                                </tr>
                            </table>
                        </div>

                        <div class="mt-3">
                            <strong>LESS: Checks Received but not Cleared</strong>
                            <table class="table table-sm table-borderless" style="font-size: 0.9em; margin-left: 20px;">
                                <tr t-foreach="r_data['uncleared_deposits']" t-as="line">
                                    <td>
                                        <span t-field="line.date"/>
                                    </td>
                                    <td>
                                        <span t-field="line.ref"/>
                                    </td>
                                    <td>
                                        <span t-field="line.partner_id.name"/>
                                    </td>
                                    <td class="text-right">
                                        <span t-field="line.debit"
                                              t-options='{"widget": "monetary", "display_currency": o.currency_id}'/>
                                    </td>
                                </tr>
                                <tr style="border-top: 1px solid #ccc;">
                                    <td colspan="3" class="text-right">
                                        <strong>Total Uncleared:</strong>
                                    </td>
                                    <td class="text-right">
                                        <span t-esc="r_data['total_uncleared']"
                                              t-options='{"widget": "monetary", "display_currency": o.currency_id}'/>
                                    </td>
                                </tr>
                            </table>
                        </div>

                        <div class="row mt-4" style="border-top: 2px solid black; padding-top: 10px; font-size: 1.1em;">
                            <div class="col-8">
                                <strong>Balance as per Bank (Computed)</strong>
                            </div>
                            <div class="col-4 text-right">
                                <span t-field="o.bank_balance"
                                      t-options='{"widget": "monetary", "display_currency": o.currency_id}'/>
                            </div>
                        </div>

                        <div class="row mt-2">
                            <div class="col-8">Balance as per Statement (Actual)</div>
                            <div class="col-4 text-right">
                                <span t-field="o.balance_end_real"
                                      t-options='{"widget": "monetary", "display_currency": o.currency_id}'/>
                            </div>
                        </div>

                        <div class="row mt-2">
                            <div class="col-8">
                                <strong>Variance</strong>
                            </div>
                            <div class="col-4 text-right">
                                <span t-field="o.unreconciled_variance"
                                      t-options='{"widget": "monetary", "display_currency": o.currency_id}'
                                      t-att-style="'color: red;' if o.unreconciled_variance != 0 else 'color: green;'"/>
                            </div>
                        </div>

                        <div class="row mt-5" style="margin-top: 100px;">
                            <div class="col-6 text-center">
                                <div style="border-top: 1px solid black; width: 80%; margin: 0 auto;">Prepared By</div>
                            </div>
                            <div class="col-6 text-center">
                                <div style="border-top: 1px solid black; width: 80%; margin: 0 auto;">Approved By</div>
                            </div>
                        </div>

                    </div>
                </t>
            </t>
        </t>
    </template>
</odoo>